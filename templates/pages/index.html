{% extends "base.html" %}

{% block title %}BYGONE | Home{% endblock %}

{% block content %}
<div class="index-container">
  <!-- Left: Map -->
  <div class="map-column">
      <div class="map-wrapper">
          <div id="map"></div>
      </div>
  </div>

  <!-- Right: Themes -->
  <aside class="routes-column">
    <h2>Explore Routes</h2>
    <ul class="routes-list">
      {% for route in routes %}
        <li>
          <a class="routes-btn" href="{{ url_for('routes_app.view_route', route_name=route.name) }}">
            {{ route.name }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </aside>
</div>

<script>
  // Locations from Flask, converted safely to JS
  const locations = {{ locations | tojson | safe }};
  const photos = {{ photos | tojson | safe }};
  // Default centre: Dublin
  const defaultLat = 53.3498;
  const defaultLon = -6.2603;

  // Initialise map
  const map = L.map("map").setView([defaultLat, defaultLon], 14);

  // Base map tiles
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Add markers
  const markers = [];

  locations.forEach(loc => {
    if (loc.lat == null || loc.lon == null) {
      return; // skip if coords missing
    }

    const marker = L.marker([loc.lat, loc.lon]).addTo(map);

    const popupHtml = `
      <b>${loc.name}</b><br>
      <img src="/static/images/${loc.main_image}" width="200"><br>
      <a href="/gallery/${loc.id}" target="_blank">See more photos</a>
    `;

    marker.bindPopup(popupHtml);
    markers.push(marker);
  });

  // Add photo markers (small black markers)
  photos.forEach(photo => {
    if (photo.lat == null || photo.lon == null) {
      return; // skip photos without coordinates
    }

    const icon = L.icon({
      iconUrl: "/static/icons/photo-marker-black.png",  // you will add this file
      iconSize: [14, 14],
      iconAnchor: [7, 7]
    });

    const marker = L.marker([photo.lat, photo.lon], { icon }).addTo(map);

    const popupHtml = `
        <b>${photo.title}</b><br>
        <img src="/static/images/${photo.file}" width="180"><br>
        <small>Photo</small>
    `;

    marker.bindPopup(popupHtml);
    markers.push(marker);
  });


  // Auto-fit map to markers if you like (optional)
  if (markers.length > 0) {
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.2));
  }
</script>

{% endblock %}